<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>キャラ検索・unitCSV抽出ツール</title>
<style>
body { font-family: sans-serif; background: #0b1220; color: #fff; padding: 20px; }
input, button { font-size: 14px; margin: 5px; }
#results { margin-top: 10px; }
.result-item { cursor: pointer; padding: 4px; background: #071427; margin: 2px 0; border-radius: 4px; }
.result-item:hover { background: #1a2030; }
textarea { width: 100%; height: 200px; margin-top: 10px; background: #071427; color: #fff; }
</style>
</head>
<body>
<h2>キャラ検索・unitCSV抽出ツール</h2>

<input type="text" id="searchInput" placeholder="キャラ名を入力">
<div id="results"></div>

<textarea id="output" readonly></textarea><br>
<button id="copyBtn">コピー</button>

<!-- 生成済み CSV 配列を読み込む -->
<script src="./fileList.js"></script>

<script>
// CSVを配列に変換
function parseCSV(text) {
  return text.trim().split(/\r?\n/).map(line => line.split(','));
}

// fetchで複数CSVを読み込み
async function loadCSVs(filePaths) {
  const allData = [];
  for (const path of filePaths) {
    const res = await fetch(path);
    const text = await res.text();
    allData.push(...parseCSV(text));
  }
  return allData;
}

let explanationData = [];
let unitData = [];

async function init() {
  explanationData = await loadCSVs(explanationFiles);
  unitData = await loadCSVs(unitFiles);
  console.log(`説明CSV: ${explanationData.length}行, unitCSV: ${unitData.length}行 読み込み完了`);
}
init();

// キャラ検索
document.getElementById('searchInput').addEventListener('input', (e) => {
  const query = e.target.value.trim();
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '';
  if (!query) return;

  const matches = explanationData.filter(row => row[0].includes(query));
  matches.forEach((row, idx) => {
    const div = document.createElement('div');
    div.className = 'result-item';
    div.textContent = row[0];
    div.dataset.index = idx; 
    resultsDiv.appendChild(div);
  });
});

// 候補クリックでunitCSVを取得
document.getElementById('results').addEventListener('click', (e) => {
  if (!e.target.classList.contains('result-item')) return;
  const idx = parseInt(e.target.dataset.index);

  const outputLines = [];
  for (let i = idx; i < idx + 4; i++) {
    if (!explanationData[i]) break;
    const unitRow = unitData[i]; 
    if (!unitRow) break;
    outputLines.push(unitRow.join(','));
  }

  document.getElementById('output').value = outputLines.join('\n');
});

// コピー
document.getElementById('copyBtn').addEventListener('click', () => {
  const textarea = document.getElementById('output');
  textarea.select();
  document.execCommand('copy');
  alert('コピーしました');
});
</script>
</body>
</html>