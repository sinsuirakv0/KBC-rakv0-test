<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ガチャTSVパーサー</title>
  <style>
    body { font-family: sans-serif; padding: 1em; }
    textarea { width: 100%; height: 200px; }
    pre { background: #f0f0f0; padding: 1em; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>ガチャTSVパーサー</h1>
  <input type="file" id="fileInput" accept=".txt,.tsv"><br><br>
  <button id="parseBtn">解析する</button>
  <pre id="output">ここに解析結果が表示されます</pre>

  <script>
    let rawText = '';

    document.getElementById('fileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        rawText = event.target.result;
      };
      reader.readAsText(file, 'utf-8');
    });

    document.getElementById('parseBtn').addEventListener('click', () => {
      if (!rawText) return;
      const lines = rawText.trim().split('\n');
      const results = [];

      for (const line of lines) {
        const cells = line.trim().split('\t');
        if (cells.length < 10) continue;

        const header = {
          startDate: cells[0],
          startTime: cells[1],
          endDate: cells[2],
          endTime: cells[3],
          minVersion: cells[4],
          maxVersion: cells[5],
          unknown1: cells[6],
          unknown2: cells[7],
          gachaType: Number(cells[8]),
          gachaCount: Number(cells[9])
        };

        const gachas = [];
        let offset = 10;
        for (let i = 0; i < header.gachaCount; i++) {
          const gachaSlice = cells.slice(offset, offset + 15);
          const gachaId = Number(gachaSlice[0]);
          if (gachaId !== -1) {
            gachas.push({
              id: gachaId,
              price: Number(gachaSlice[1]),
              normal: Number(gachaSlice[3]),
              rare: Number(gachaSlice[5]),
              superRare: Number(gachaSlice[7]),
              uberRare: Number(gachaSlice[9]),
              guaranteed: Number(gachaSlice[10]) === 1,
              legendRare: Number(gachaSlice[11]),
              message: gachaSlice[14]
            });
          }
          offset += 15;
        }

        results.push({ header, gachas });
      }

      document.getElementById('output').textContent = JSON.stringify(results, null, 2);
    });
  </script>
</body>
</html>
